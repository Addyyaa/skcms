ndk     = ../ndk
target  = aarch64-linux-android
arch    = arch-arm64
ndk_api = 24

cc      = $ndk/toolchains/llvm/prebuilt/*/bin/clang   -target $target$ndk_api
cxx     = $ndk/toolchains/llvm/prebuilt/*/bin/clang++ -target $target$ndk_api

cflags  = -fcolor-diagnostics -Weverything --sysroot $ndk/sysroot

ldflags = -pie -fuse-ld=lld $
          --sysroot $ndk/platforms/android-$ndk_api/$arch $
          -L $ndk/toolchains/llvm/prebuilt/*/sysroot/usr/lib/$target/$ndk_api $
          -L $ndk/toolchains/llvm/prebuilt/*/sysroot/usr/lib/$target $
          -static-libstdc++

out     = out/android$mode

rule run
    command = if which adb >/dev/null && adb get-state >/dev/null 2>/dev/null; $
              then $
                  adb push --sync profiles /data/local/tmp >/dev/null; $
                  adb push $in /data/local/tmp/$in >/dev/null; $
                  adb shell "cd /data/local/tmp; taskset f ./$in" > $out; $
              else touch $out; fi
    description = run $in
include build/common
