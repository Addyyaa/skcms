builddir = $out
disabled = false

# Each compiler has enabled all the warnings it can.
# Here we make them errors, and disable a few we don't want bothering us.
# TODO: -Wno-reserved-id-macro can go away when we refactor skcms_Transform().
warnings = -Werror $
           -Wno-double-promotion $
           -Wno-float-equal $
           -Wno-gnu-anonymous-struct $
           -Wno-padded $
           -Wno-reserved-id-macro $

warnings_cc = $warnings $
           -Wno-c++98-compat-pedantic $
           -Wno-c99-extensions $
           -Wno-narrowing $
           -Wno-old-style-cast $
           -Wno-zero-as-null-pointer-constant $


rule compile_c
    command = $disabled && touch $out || $cc -std=c11 -g -Os $warnings $cflags $extra_cflags $
             -MD -MF $out.d -c $in -o $out
    depfile = $out.d
    deps    = gcc
    description = compile $out

rule compile_cc
    command = $disabled && touch $out || $cc -std=c++11 -g -Os $warnings_cc $cflags $extra_cflags $
             -MD -MF $out.d -c $in -o $out
    depfile = $out.d
    deps    = gcc
    description = compile $out

rule link
    command = $disabled && touch $out || $cc $ldflags $extra_ldflags $in -ldl -pthread -o $out
    description = link $out

include build/targets
