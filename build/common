builddir = $out
disabled = false

rule compile
    command = $disabled && touch $out || $cc -g -Werror -Os $warnings $cflags -MD -MF $out.d -c $in -o $out
    depfile = $out.d
    deps    = gcc
    description = compile $out

rule link
    command = $disabled && touch $out || $cc $ldflags $in -o $out
    description = link $out

rule run
    command = $disabled && touch $out || ./$in > $out
    description = run $in

build $out/skcms.o:  compile skcms.c

build $out/tests.o:  compile tests.c
build $out/tests:    link $out/skcms.o $out/tests.o
build $out/tests.ok: run  $out/tests

build $out/iccdump.o: compile iccdump.c
build $out/iccdump:   link $out/skcms.o $out/iccdump.o
